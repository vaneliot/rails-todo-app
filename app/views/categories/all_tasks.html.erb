<% if false %>
    <%= link_to 'Go to Tasks Page', category_tasks_path(@categories, @tasks) %>
    <hr /><br />
    <button><%= link_to '+ Create New Category', new_category_path %></button>
<% end %>
<h3>All Tasks</h3>
<% if @categories.length > 0 %>
    <table>
        <% if false %>
            <thead>
                <tr>
                    
                    <th>Name</th>
                    <th>Description</th>
                    <th>Date Created</th>
                    <th colspan="3">options</th>
                </tr>
            </thead>
        <% end %>

        <% @categories.each do |category| %>
            <% if false %>
                <tbody>
                    <tr>
                        
                        <td><%= category.name %></td>
                        <td><%= category.description %></td>
                        <td><%= category.created_at %></td>

                        <td><%= link_to 'Show', category_path(category) %></td>
                        <td><%= link_to 'Edit', edit_category_path(category) %></td>
                        <td><%= link_to 'Delete', category_path(category), method: :delete, data: { confirm: 'Are you sure? All tasks under this category will also be deleted.' } %></td>
                    </tr>
                </tbody>
            <% end %>

            <% @included_tasks = category.tasks%>
            <% if @included_tasks.length > 0%>
                <thead>
                    <tr>
                        <th> Tasks under <%=category.name%> </th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Deadline</th>
                        <th>Started</th>
                        <th>Completed</th>
                        <th colspan="3">options</th>
                        <th>
                            <button><%= link_to '+ add a task to ' + category.name, new_category_task_path(category) %></button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <% @categories = Category.all %>
                    <% @users = User.all %>
                    <% @included_tasks.each do |task| %>
                        <tr>
                            <td> > </td>
                            <td><%= task.name %></td>
                            <td><%= task.description %></td>
                            <td><%= task.deadline %></td>
                            <td><%= task.started ? 'yes' : 'no' %></td>
                            <td><%= task.completed ? 'yes' : 'no' %></td>

                            <td><%= link_to 'Show', category_task_path(task, :category_id => category.id) %></td>
                            <td><%= link_to 'Edit', edit_category_task_path(task, :category_id => category.id, :id => task.id) %></td>
                            <td><%= link_to 'Delete', category_task_path(task, :category_id => category.id), method: :delete, data: { confirm: 'Are you sure?' } %></td>
                            <td> owned by <%= @users.find_by(id: task.user_id).email %></td>
                        </tr>
                    <% end %>
                </tbody>
            <% else %>            
                <thead>
                    <tr>
                        <th> Tasks under <%=category.name%></th>
                        <td colspan="8"> (no tasks yet) </td>
                        <th>
                            <button><%= link_to '+ add a task to ' + category.name, new_category_task_path(category) %></button>
                        </th>
                    </tr>
                </thead>
            <% end %>
        <% end %>
    </table>
<% else %>
    <h3>There are no categories yet. Go and create one! <button><%= link_to '+ Create New Category', new_category_path %></button></h3>
    
<% end %>



